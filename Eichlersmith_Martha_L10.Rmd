---
title: "L10 Data Wrangling"
subtitle: "Data Visualization (STAT 302)"
author: "Martha Eichlersmith"
date: 2020-05-10
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
editor_options: 
  chunk_output_type: inline
---

```{r L10-global-options, include = FALSE}
knitr::opts_chunk$set(dpi = 300)
```

## Overview

The goal of this lab is to use data manipulation and transformation techniques to help use build a few plots. 

## Datasets

We'll be using the `mod_nba2014_15_advanced.txt` and `NU_admission_data.csv` datasets --- add both to the project's **data** subdirectory. The `codebook_mod_nba2014_15_advanced.txt` file supplies a quick description of the variables in the `mod_nba2014_15_advanced.txt` dataset --- suggest adding it to the **data** subdirectory as well. The `undergraduate-admissions-statistics.pdf` is the source for the `NU_admission_data.csv` dataset and it also contains the graphic/plot we will be attempting to re-create in the second exercise. 


```{r L10-packages-data, message=FALSE}
# Load package(s)
library(tidyverse)
library(ggthemes)

# Read in the datasets
nba <- read_delim(file = "data/mod_nba2014_15_advanced.txt", delim = "|")
admission <- read_csv(file ="data/NU_admission_data.csv")
```


## Exercises



### Exercise 1

Using the `mod_nba2014_15.txt` dataset try to recreate/approximate the plot type featured in the [http://fivethirtyeight.com/](fivethirtyeight.com) article [Kawhi Leonard Is The Most Well-Rounded Elite Shooter Since Larry Bird](http://fivethirtyeight.com/features/kawhi-leonard-is-the-most-well-rounded-elite-shooter-since-larry-bird/) for any player of your choice for the 2014-2015 season. When calculating quartiles or considering players you may want to exclude players that played less than 10 games or played less than 5 minutes a game. That is, we only want to look for "qualified" players.

*Hints:*

Image width 8 in, height 10 in. Can be achieved many ways:

- Set figure height and width in R chuck's options
- Save image with `ggsave()` and then insert it using markdown code:
    - `![Caption - leave blank](/path/to/image.png)`
    - Set figure height and width in R chuck's options and then use `knitr::include_graphic(/path/to/image.png)`



```{r helper-function}
quartile_rank <- function(x = 0:99) {
  
  # Set quartile
  quart_breaks <- c(
    -Inf,
    quantile(x,
      probs = c(.25, .5, .75),
      na.rm = TRUE
    ),
    Inf
  )

  cut(x = x, breaks = quart_breaks, labels = FALSE)
}
```

```{r}
  
```


```{r L10-EX1-data}
nba_5metrics <- nba %>%
  filter(G > 10, MP > 5) %>%
  mutate(
     qTS_perc  = quartile_rank(TS_perc)
    , qUSG_perc = quartile_rank(USG_perc)
    , qDBPM     = quartile_rank(DBPM)
    , qTRB_perc = quartile_rank(TRB_perc)
    , qAST_perc = quartile_rank(AST_perc)
  ) %>%
  select(Player, qTS_perc, qUSG_perc, qDBPM, qTRB_perc, qAST_perc)

LJ <- nba_5metrics %>%
  filter(Player == "LeBron James") %>%
  pivot_longer(cols=c(-Player))

x_limits <- LJ$name

```

```{r L10-EX1-func}
plot_nba <- function(fivemetrics, playername){
  #create tidy df for specific player
  player_df <- fivemetrics %>%
    filter(Player == playername) %>%
    pivot_longer(cols = c(-Player), names_to = "metric", values_to = "rank")
  
  #denote limts, breaks and labels 
  x_limits <- player_df$metric
  x_labels <- c("True\nShooting", "Usage\nRate", "Defensive\nBPM", "Rebound\nRate", "Assist\nRate")
  y_labels <- c("1st-25th", "25th-50th", "50th-75th", "75th-99th")
  y_breaks <- c(1, 2, 3, 4)
  
  y_labels_df <- data.frame(
      metric = c(rep("qDBPM", 4))
    , y_breaks = y_breaks
    , y_labels = y_labels
  )
  
  #data frame for vertical lines between metrics
  v_lines <- data.frame(
      x = seq(1.5, 5.5, 1)
    , xend = seq(1.5, 5.5, 1)
    , y = rep(0, 5)
    , yend = rep(4, 5)
  )
  
  #create plot
  ggplot(player_df, aes(metric, rank)) +
    geom_col(
        width = 1
      , fill = "red"
      , alpha = 0.5
    ) +
    coord_polar() + 
    scale_y_continuous(
       breaks = c(1, 2, 3, 4)
    ) +
    scale_x_discrete(
        limits = x_limits 
      , labels = NULL
      , breaks = x_limits
    ) +
    geom_segment(
        data = v_lines
      , aes(x = x, xend = xend, y=y, yend=yend)
      , color = "black"
    ) +
    geom_hline(yintercept = y_breaks, linetype = "dotted")+
    geom_text(
        aes(label = toupper(x_labels), y=5)
    ) +
    geom_text(
        data = y_labels_df 
      , aes(label = y_labels, y=y_breaks, x=metric)
      , vjust = -0.75
    ) +
    theme_void() +
    ggtitle(paste(playername, "\n(2015)")) +
    theme(
       panel.background = element_rect(fill = "grey90", color = NA)
      , plot.title = element_text(hjust = 0.5, size = 20)
    ) 
}
```

```{r, fig.width=8, fig.height=10}
plot_nba(nba_5metrics, "LeBron James")
```


```{r}
v_lines <- data.frame(
    x = seq(1.5, 5.5, 1)
  , xend = seq(1.5, 5.5, 1)
  , y = rep(0, 5)
  , yend = rep(4, 5)
)


```


```{r}
x_labels <- c("True\nShooting", "Usage\nRate", "Defensive\nBPM", "Rebound\nRate", "Assist\nRate")
y_labels <- c("1st-25th", "25th-50th", "50th-75th", "75th-99th")
y_breaks <- c(1, 2, 3, 4)

y_labels_df <- data.frame(
    name = c(rep("qDBPM", 4))
  , y = y_breaks
  , y_lab = y_labels
)



```


```{r, fig.width=8, fig.height=10}


LJ  %>%
ggplot(aes(name, value)) +
  geom_col(
      width = 1
    , fill = "red"
    , alpha = 0.5
  ) +
  coord_polar() + 
  scale_y_continuous(
     breaks = c(1, 2, 3, 4)
  ) +
  scale_x_discrete(
      limits = x_limits 
    , labels = NULL
    , breaks = x_limits
  ) +
  geom_segment(
      data = v_lines
    , aes(x = x, xend = xend, y=y, yend=yend)
    , color = "black"
  ) +
  geom_hline(yintercept = y_breaks, linetype = "dotted")+
  geom_text(
      aes(label = toupper(x_labels), y=5)
  ) +
  geom_text(
      data = y_labels_df 
    , aes(label = y_lab, y=y, x=name)
    , vjust = -0.75
  ) +
  theme_void() +
  ggtitle("LeBron James\n(2015)") +
  theme(
     panel.background = element_rect(fill = "grey90", color = NA)
    , plot.title = element_text(hjust = 0.5, size = 20)
  ) 

```


<br>

### Exercise 2

Using `NU_admission_data.csv` create two separate plots derived from the single plot depicted in `undergraduate-admissions-statistics.pdf`. They overlaid two plots on one another by using two y-axes. Create two separate plots that display the same information instead of trying to put it all in one single plot --- consider stacking them with `cowplot::plot_grid()`. Also, improve upon them by (1) fixing their error with the bar heights and (2) by using a "Northwestern" theme. 

Also, practice placing all the text information on the appropriate plots. While I'm not a fan and think it is unnecessary for telling the actual story of the data, sometimes clients want this and there are those that think detailed labeling enhances the plot's value --- they do have a point. When including detailed labeling like this take care to pick label fonts and colors so the text doesn't take away the from the message of the data (the trend in these plots). With these labels you could image removing the y-axes altogether so they don't distracts the reader/consumer. 

Which approach do you find communicates the information better, their single plot or the two plot approach? Why?

*Hints:*

- Form 4 datasets (helps you get organized, but not entirely necessary): 
    - 1 that has bar chart data, 
    - 1 that has bar chart label data, 
    - 1 that has line chart data, and 
    - 1 that has line chart labels 
- Decide on image size to aid in the selection of text sizes and location (9 in width, 4 in height - just a suggestion)

<br>

## Challenge(s)

**No not have to complete.**

Using `NU_admission_data.csv` try to re-create/approximate the single plot depicted in `undergraduate-admissions-statistics.pdf`. Fix their error concerning the bar heights. Might want to simply start with one of your plots from Exercise 2 and see if it can be modified. 
