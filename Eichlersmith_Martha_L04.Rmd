---
title: "L04 ggplot III"
subtitle: "Data Visualization (STAT 302)"
author: "Martha Eichlersmith"
date: 2020-04-19
output:
  html_document:
    toc: true
    toc_float: true
---

## Overview

The goal of this lab is to continue the process of unlocking the power of `ggplot2` through constructing and experimenting with a few basic plots.

**Load Packages:** `tidyverse`, `gridExtra`, `ggrepel`  
```{r L04-load-packages, warning=FALSE, message=FALSE}
# Load package(s)
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(gridExtra))
suppressPackageStartupMessages(library(ggrepel))
```

## Datasets

We'll be using data from the `blue_jays.rda`, `tech_stocks.rda`, `corruption.rda`, and `cdc.txt` datasets which are already in the `/data` subdirectory in our **data_vis_labs** project. 


```{r LO4-load-data, message=FALSE}
# Load datasets
load(file="data/blue_jays.rda")
load(file="data/tech_stocks.rda")
load(file="data/corruption.rda")

# Read in the cdc dataset
cdc <- read_delim(
  file = "data/cdc.txt"
  , delim = "|"
  ) %>%
  mutate(genhlth = factor(genhlth,
    levels = c("excellent", "very good", "good", "fair", "poor")
  ))
```


## Exercises

Complete the following exercises.

<br>

### Exercise 1

Using `blue_jays.rda` dataset, recreate the following graphic as precisely as possible.

*Hints:*

- Transparency is 0.6
- Point size 2
- Shift text horizontally by 0.5
- See pg 44 in *ggplot2*

```{r, L04-EX1}
caption <- paste("Head length versus body mass for", nrow(blue_jays), "blue jays")
caption_print <- paste(strwrap(caption, 40), collapse ="\n") 

topHead <- blue_jays %>% 
  arrange(desc(Head)) %>%
  group_by(KnownSex) %>% 
  top_n(n=2, wt=Head)

Labels <- topHead[c(1,4),]

#ANOTHER OPTIONS: lable dataframe 
#search by BirdID
#specialbirds <- blue_jays  %>% 
#  filter(BirdID %in% c("1142-05914", "702-90567"))
#Lables <- specialbirds

#ANOTHER OPTION: not showing legend 
#instead of doing theme(legend.position = "none")
#   geom_[geom](..... show.legend=FALSE) --> for each geom say show.legend = FALSE 

#ANOTHER OPTION: labeling certain points 
#   directlabels::geom_dl(aes(label=KnownSex), method="top.points")
#   directlabels::geom_dl(aes(label=KnownSex), method="smart.grid")
#   these do not allow for nudging though :()

ggplot(blue_jays, aes(Mass, Head, color=KnownSex))+
  geom_point(alpha=0.6, size=2)+
  annotate(
     "text"
    ,x=range(blue_jays$Mass)[1]
    ,y=range(blue_jays$Head)[2]
    ,label=caption
    ,hjust=0
    ,vjust=1
    )+
  xlab("Body Mass (g)")+
  ylab("Head length (mm)")+
  theme(legend.position = "none")+
  geom_text(data=Labels, aes(label=KnownSex), nudge_x=0.5)
```


<br>

### Exercise 2

Using `tech_stocks` dataset, recreate the following graphics as precisely as possible.  

<br>

#### Plot 1

*Hints:*

- serif font

```{r L04-EX2-plot1, warning=FALSE}
caption <- paste("Stock price over time for four major tech companies")
caption_print <- paste(strwrap(caption, 40), collapse ="\n")  


Labels <- tech_stocks %>%
  arrange(desc(date)) %>% #order by date 
  distinct(company, .keep_all=TRUE) # return distinct company

#ANOTHER OPTIONS: lable dataframe 
#Labels <- tech_stocks %>%
#  ungroup %>% 
#  group_by(company) %>% 
#  top_n(1, wt=date)


ggplot(tech_stocks, aes(date, price_indexed))+
  geom_line(aes(color=company))+
  theme(legend.position = "none")+
  xlab(NULL)+
  ylab("Stock price, indexed")+
  annotate(
     "text"
    ,x=range(tech_stocks$date)[1]
    ,y=range(tech_stocks$price_indexed)[2]
    ,label=caption
    ,hjust=0
    ,vjust=1
    ,family="serif"
    )+
  geom_text(data=Labels, aes(label=company))

```



<br>

#### Plot 2

*Hints:*

- Package `ggrepel`
- `box.padding` is 0.6
- Minimum segment length is 0 
- Horizontal justification is to the right
- seed of 9876

```{r L04-EX2-plot2}
caption <- paste("Stock price over time for four major tech companies")
caption_print <- paste(strwrap(caption, 40), collapse ="\n")  

Labels <- tech_stocks %>%
  group_by(company) %>% 
  top_n(1, wt=date)

ggplot(tech_stocks, aes(date, price_indexed))+
  geom_line(aes(color=company))+
  theme(legend.position = "none")+
  xlab(NULL)+
  ylab("Stock price, indexed")+
  annotate(
     "text"
    ,x=range(tech_stocks$date)[1]
    ,y=range(tech_stocks$price_indexed)[2]
    ,label=caption
    ,hjust=0
    ,vjust=1
    ,family="serif"
    )+
  geom_text_repel(
      data=Labels
    , aes(label=company)
    , box.padding = 0.6
    , min.segment.length=0
    , hjust=1
    , seed = 9876
    )
```


<br>

### Exercise 3

Using `corruption.rda` dataset, recreate the following graphic as precisely as possible.

*Hints:*

- Transparency is 0.6
- Only use 2015 data
- Color used is `grey60`
- `"y ~ log(x)"` (method `"lm"`)
- Package `ggrepel`
- `box.padding` is 0.6
- Minimum segment length is 0 
- seed is 9876
  
```{r L04-EX3}
corruption_2015 <- corruption %>%
  drop_na(cpi, hdi) %>%
  filter(year == 2015)

CountriesToLabel <- c("Niger", "Iraq", "China", "Ghana", "Argentina", "Chile", "Japan", "United States", "Singapore")

Labels <- corruption_2015 %>%
  filter( country %in% CountriesToLabel)

ggplot(corruption_2015, aes(cpi, hdi))+
  geom_point(aes(color=region), alpha=0.6, size=2)+
  geom_smooth(method="lm", formula= y~log(x), color="grey60", se=FALSE)+
  xlab("Corruption Perceptions Index, 2015 (100=least corrupt)")+
  ylab("Human Development Index, 2015\n (1.0 = most developed)")+
  geom_text_repel(
      data=Labels
    , aes(label=country)
    , box.padding = 0.6
    , min.segment.length=0
    , seed = 9876
    )
```


```{r}



```

<br>

### Exercise 4

Using `cdc` dataset, recreate the described graphic as precisely as possible.

Using Bilbo Baggins' responses below to the CDC BRSFF questions, add Bilbo's data point as a transparent (0.5) solid red circle of size 4 to a scatterplot of `weight` by `height` with transparent (0.1) solid blue circles of size 2 as the plotting characters. In addition, label the point with his name in red. Left justify and rotate the label so it reads vertically from bottom to top --- shift it up by 10 pounds too. Plot should use appropriately formatted axis labels. Remember that the default shape is a solid circle.

* `genhlth` - How would you rate your general health? **fair**
* `exerany` - Have you exercised in the past month? **1=yes**
* `hlthplan` - Do you have some form of health coverage? **0=no**
* `smoke100` - Have you smoked at least 100 cigarettes in your life time? **1=yes** 
* `height` -  height in inches: **46**
* `weight` - weight in pounds: **120**
* `wtdesire` - weight desired in pounds: **120**
* `age` - in years: **45**
* `gender` - m for males and f for females: **m**

<br>

*Hint:* Create a new dataset (maybe call it `bilbo` or `bilbo_baggins`) using either `data.frame()` (base R - example in book) or `tibble()` (tidyverse - see help documentation for the function). Make sure to use variable names that exactly match `cdc`'s variable names

```{r L04-EX4}
bilbo <- tibble(
  genhlth = "fair",
  exerancy = 1, 
  hlthplan = 0, 
  smoke100 = 1, 
  height = 46, 
  weight=120, 
  wtdesire = 120, 
  age = 45, 
  gender = "m"
)

ggplot(cdc, aes(height, weight))+
  geom_point(alpha=0.1, color="blue", size=2)+
  xlab("Height (inches)")+
  ylab("Weight (pounds)")+
  geom_point(data=bilbo, color="red", size=4, alpha=0.5)+
  geom_text(
      data=bilbo
    , aes(label="Bilbo Baggins")
    , color="red"
    , hjust=0 
    , angle = 90
    , nudge_y = 10
    )
```










